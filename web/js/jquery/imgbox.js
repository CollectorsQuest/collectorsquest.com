(function(h){h.fn.fixPNG=function(){return this.each(function(){var A=h(this).css("backgroundImage");if(A.match(/^url\(["']?(.*\.png)["']?\)$/i)){A=RegExp.$1;h(this).css({backgroundImage:"none",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod="+(h(this).css("backgroundRepeat")=="no-repeat"?"crop":"scale")+", src='"+A+"')"}).each(function(){var B=h(this).css("position");if(B!="absolute"&&B!="relative"){h(this).css("position","relative")}})}})};var x,p,t,z,i,y=false,a,k=90,g=0,j=20,r=20,d=h.extend(h("<div/>")[0],{prop:0});h.fn.imgbox=function(A){return this.unbind("click.pb").bind("click.pb",function(){h.imgbox(h(this),A);return false})};h.imgbox=function(A,B){if(y){return false}x=A;p=h.extend({},h.fn.imgbox.defaults,B);a=x[0].id;if(h("#imgbox-wrap-"+a).length){q();return false}e();if(p.overlayShow){h("#imgbox-overlay").unbind().stop().hide().css({height:h(document).height(),opacity:p.overlayOpacity}).show()}t=new Image;t.src=h(x).attr("href");if(t.complete==false){c();h(t).unbind().one("load",function(){e();w()})}else{w()}};h.fn.imgbox.defaults={padding:10,alignment:"auto",allowMultiple:true,autoScale:true,speedIn:500,speedOut:500,easingIn:"swing",easingOut:"swing",zoomOpacity:false,overlayShow:false,overlayOpacity:0.5,hideOnOverlayClick:true,hideOnContentClick:true};function w(){y=true;if(p.allowMultiple==false){h(".imgbox-wrap").remove();h(".imgbox-bg-wrap").remove()}else{k=k+2}i=n();var A=h(x).attr("title")||"";h('<div id="imgbox-wrap-'+a+'" class="imgbox-wrap"></div>').css({"z-index":k,padding:p.padding}).append('<img class="imgbox-img" id="imgbox-img-'+a+'" src="'+t.src+'" alt="'+A+'" />').appendTo("body");h('<div id="imgbox-bg-'+a+'" class="imgbox-bg-wrap"><div class="imgbox-bg imgbox-bg-n"/><div class="imgbox-bg imgbox-bg-ne"/><div class="imgbox-bg imgbox-bg-e"/><div class="imgbox-bg imgbox-bg-se"/><div class="imgbox-bg imgbox-bg-s"/><div class="imgbox-bg imgbox-bg-sw"/><div class="imgbox-bg imgbox-bg-w"/><div class="imgbox-bg imgbox-bg-nw"/></div>').appendTo("body");if(h.browser.msie&&parseInt(h.browser.version.substr(0,1))<7){h("#imgbox-bg-"+a).find(".imgbox-bg").fixPNG()}g=0;if(A.length>0){h('<div id="imgbox-tmp" class="imgbox-title" />').html(A).css("width",i.width).appendTo("body");g=h("#imgbox-tmp").outerHeight();i.height+=g;i.top-=g>r+j?r:r*0.5;h("#imgbox-tmp").remove();h("#imgbox-wrap-"+a).append('<div class="imgbox-title">'+A+"</div>")}if(p.speedIn>0){var B=o();z={top:B.top-p.padding,left:B.left-p.padding,width:B.width,height:B.height};h("#imgbox-wrap-"+a).css(z).show();h("#imgbox-bg-"+a).css({top:z.top,left:z.left,width:z.width+(p.padding*2),height:z.height+(p.padding*2),"z-index":k-1}).show();if(p.zoomOpacity){i.opacity=1}d.prop=0;h(d).animate({prop:1},{duration:p.speedIn,easing:p.easingIn,step:l,complete:b})}else{h("#imgbox-img-"+a).css("height",(i.height-g)+"px");h("#imgbox-wrap-"+a).css(i).fadeIn("normal",b);h("#imgbox-bg-"+a).css({top:i.top,left:i.left,width:i.width+(p.padding*2),height:i.height+(p.padding*2),"z-index":k-1}).fadeIn("normal")}}function l(F){var C=Math.round(z.width+(i.width-z.width)*F);var A=Math.round(z.height+(i.height-z.height)*F);var E=Math.round(z.top+(i.top-z.top)*F);var D=Math.round(z.left+(i.left-z.left)*F);h("#imgbox-wrap-"+a).css({width:C+"px",height:A+"px",top:E+"px",left:D+"px"});h("#imgbox-bg-"+a).css({width:Math.round(C+p.padding*2)+"px",height:Math.round(A+p.padding*2)+"px",top:E+"px",left:D+"px"});h("#imgbox-img-"+a).css("height",Math.round(A-((((A-Math.min(z.height,i.height))*100)/(Math.max(z.height-i.height,i.height-z.height))*g/100)))+"px");if(typeof i.opacity!=="undefined"){var B=F<0.3?0.3:F;h("#imgbox-wrap-"+a).css("opacity",B);if(h.browser.msie==false){h("#imgbox-bg-"+a).css("opacity",B)}}}function b(){if(p.overlayShow&&p.hideOnOverlayClick){h("#imgbox-overlay").bind("click",{elem:x,nr:a,opts:p,titleh:g},m)}h("#imgbox-wrap-"+a).css("filter","").bind("click",{elem:x,nr:a,opts:p,titleh:g},m).append('<a href="javascript:;" class="imgbox-close"></a>').children(".imgbox-title").show();if(h.browser.msie&&parseInt(h.browser.version.substr(0,1))<7){h("#imgbox-wrap-"+a).find(".imgbox-close").fixPNG()}y=false}function m(A){A.stopPropagation();if(A.target.className=="imgbox-close"||(A.data.opts.hideOnOverlayClick&&A.target.id=="imgbox-overlay")||(A.data.opts.hideOnContentClick&&A.target.className=="imgbox-img"&&(h(this).css("z-index")==k||h(".imgbox-img").length==1))){x=A.data.elem;a=A.data.nr;p=A.data.opts;g=A.data.titleh;q()}else{if(h(this).css("z-index")<k){h(this).next(".imgbox-bg-wrap").css("z-index",++k);h(this).css("z-index",++k)}}}function q(){if(y){return false}y=true;h("#imgbox-wrap-"+a).children(".imgbox-close, .imgbox-title").remove();if(p.speedOut>0){var A=o();z={top:A.top-p.padding,left:A.left-p.padding,width:A.width,height:A.height};var A=h("#imgbox-wrap-"+a).position();i={top:A.top,left:A.left,width:h("#imgbox-wrap-"+a).width(),height:h("#imgbox-wrap-"+a).height()};if(p.zoomOpacity){i.opacity=0}setTimeout(function(){h("#imgbox-wrap-"+a).css("z-index",90);h("#imgbox-bg-"+a).css("z-index",90)},p.speedOut*0.5);d.prop=1;h(d).animate({prop:0},{duration:p.speedIn,easing:p.easingIn,step:l,complete:f})}else{if(p.overlayShow){f()}else{h("#imgbox-bg-"+a).fadeOut("fast");h("#imgbox-wrap-"+a).fadeOut("fast",f)}}}function f(){h("#imgbox-bg-"+a).stop().remove();h("#imgbox-wrap-"+a).remove();k=k>90?k-2:90;if(p.overlayShow){h("#imgbox-overlay").unbind().stop().fadeOut(200)}y=false}function n(){var C=v();var F={width:t.width,height:t.height};var E=(p.padding+j+r)*2;var B=(p.padding+j+r)*2;if(p.autoScale&&(F.width>(C[0]-E)||F.height>(C[1]-B))){var A=Math.min(Math.min(C[0]-E,F.width)/F.width,Math.min(C[1]-B,F.height)/F.height);F.width=Math.round(A*F.width);F.height=Math.round(A*F.height)}if(p.alignment=="center"){F.top=C[3]+((C[1]-F.height-p.padding*2)*0.5);F.left=C[2]+((C[0]-F.width-p.padding*2)*0.5)}else{var D=o();F.top=D.top-((F.height-D.height)*0.5)-p.padding;F.left=D.left-((F.width-D.width)*0.5)-p.padding;F.top=F.top>C[3]+r+j?F.top:C[3]+r+j;F.left=F.left>C[2]+r+j?F.left:C[2]+r+j;F.top=F.top>C[1]+C[3]-(F.height+B)?C[1]+C[3]-(F.height+(r+j+p.padding*2)):F.top;F.left=F.left>C[0]+C[2]-(F.width+E)?C[0]+C[2]-(F.width+(r+j+p.padding*2)):F.left}if(p.autoScale==false){F.top=F.top>C[3]+j+r?F.top:C[3]+j+r;F.left=F.left>C[2]+j+r?F.left:C[2]+j+r}F.top=parseInt(F.top);F.left=parseInt(F.left);return F}function v(){return[h(window).width(),h(window).height(),h(document).scrollLeft(),h(document).scrollTop()]}function o(){var A=h(x).find("img").eq(0);var B=A.offset();B.top+=parseFloat(A.css("paddingTop"));B.left+=parseFloat(A.css("paddingLeft"));B.top+=parseFloat(A.css("border-top-width"));B.left+=parseFloat(A.css("border-left-width"));B.width=A.width();B.height=A.height();return B}function c(){var A=o(x);h("#imgbox-loading").css(A).show()}function e(){h(t).unbind();h("#imgbox-loading").hide()}function s(){e();if(p.overlayShow){h("#imgbox-overlay").unbind().stop().fadeOut(200)}}function u(){h('<div id="imgbox-loading"><div></div></div><div id="imgbox-overlay"></div>').appendTo("body");h("#imgbox-loading").click(s).find("div").css("opacity",0.4)}h(document).ready(function(){u()})})(jQuery);